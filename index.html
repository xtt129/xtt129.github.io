<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://xtt129.github.io">
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://xtt129.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="https://avatars2.githubusercontent.com/u/3503239?v=3&amp;s=460" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">xtt129</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/xtt129" title="github">github</a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">xtt129</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="https://avatars2.githubusercontent.com/u/3503239?v=3&amp;s=460" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">xtt129</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xtt129" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Hackathon-2015" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/01/Hackathon-2015/">Hackathon 2015</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今年的Hackathon收获蛮大的，先聊经过，再说感想吧。 </p>
<p>其实这个项目是我上一次参加Hackathon留下的，由于那个时候错过了窗口期，所以想借这次hackathon再好好搞一搞，我可不想留给别人的印象是个开了个头然后就不了了之的家伙。 </p>
<p>这次比上一次我拉了更多人，有Daniel，ZhenChao，他们是上次Hackathon一起合作过的，还有同team的fega和boliang，后来还加入了一个负责ui设计的MM Yeye。 </p>
<p>项目内容是把公司的班车信息和百度地图结合起来(灵感来自车来了)，放到微信公众平台上去，让用户去订阅然后可以帮助用户推荐路线，当用户要输入一个目的地的时候，系统会告诉他可以做哪俩班车并且告诉他下车后通过哪些公共交通到达目的地。<br>差不多是个一句话能说清楚的小项目，但要想每个功能都细化好也是要花不少时间的，因为上一次的hackathon花过两天时间做过，所以跟微信的集成和百度这块的集成已经做好了的，这次主要是想把Authentication和路线推荐那块做好。</p>
<p>有了上一次的经验，我知道真正Hackathon开始之后是没有多少时间写代码了得，所以主要做了两件事情来应对：</p>
<p>1. 提前把一些Investigation的工作做掉: 比如提前一周把从EasyConnector上把公司的班车信息都爬下来了，并把Federation Authentication的基础部分给做了.</p>
<p>2. 多找了一些小伙伴一起参与并提前一周就进行了分工，比如让fega负责上层的Authentication业务逻辑，让boliang负责搜索那一块，让zhenchao继续负责前端那一块，中间把DB层从redis换到了Azure table，并让Daniel帮忙搞这块。</p>
<figure data-orig-width="695" data-orig-height="434" class="tmblr-full"><img src="http://68.media.tumblr.com/9f6ba35c96f57b15f9e7e2f550132f14/tumblr_inline_nsdb33fMyg1rnatmk_540.png" alt="image"></figure>

<p>附上系统结构图绿线表示FedAuth流程，蓝线表示公众号内对话框的数据传输过程，过程通过AES加密。</p>
<p>尽管做了以上这些准备工作，并提前给大家做了预警，但我们还是到最后一晚才把东西完整的搞出来。这让我有点回想起来平时的每一个release周期都是到了ZBB的前两天就狂发codereview和check in这种节奏，果然deadline driven才是每个程序员都倾向得开发模式。<br>这个其实也难怪大家，每次Hackathon都伴随着team的milestone一起，所以大家要一边赶公司的活一边做Hackathon，而我更是hackathon第一天其实就没怎么开发主要都在干公司的活。 </p>
<p>到了ScienceFair当天前一晚，搜索接口还没有调通，然后手头没有准备好的事情是要准备第二天的presentation，要准备一份英文讲稿，然后整个产品最后E2E都还没有跑通，AuthN偶尔也会有些bug，然后宣传材料，第二天展位上要展示的东西就压根没想起来，以至于Science Fair开始前1个小时我还匆匆跑到1号楼在打印宣传材料，二维码这样的东西。 </p>
<p>蛋妞在整个过程中好几次都说我过分关注细节，主次不分，应该做些把控大局的事情的时候偏去做些小事，比如在Science Fair前两天的时候还在想怎么把bing地图加进去以支持英文地图展示，而不是去从Lead的角度怎么把所有人的工作串起来，看看还缺什么，又比如在Science Fair当天人流已经过来的时候还在专心做PPT，细抠一些PPT上的细节，而错过了最佳的拉选票时机。 </p>
<p>复盘： </p>
<p>这次Hackathon不论从产品实现还是最后的影响力方面，都是比去年要好很多的，有用户听了我们的项目介绍后表示后悔把票投给别人了，最大的收获是有一个Biz App Group的老大告诉我说其实公司有一个认证了得微信公众号，但是没有我们的功能，希望可以合起来。 </p>
<p>整体上做的比较好地方是:</p>
<p>1.首先是选择了继续做这个项目，确实很犹豫是否要拿这个项目参加，直到想明白不了了之的话以后参加hackathon会很没面子才确信要做的。</p>
<p>2.时间节点上的思路是对的，hackathon开始之后确实没有很多时间做技术调研，在hackathon开始之前就把fedauth和班车数据给弄好省下了不少时间。 </p>
<p>然后几个不好的地方是：</p>
<p>1. 首先最大的是蛋妞说的主次不分，缺乏规划，在重要的时间去做不重要的事。</p>
<p>2. 虽然危机意识够，但是在动员大家上还是不够给力，自己的执行力也不够高，前一个礼拜说好每天要有开发进度的结果自己都没有做到。</p>
<p>3. 宣讲方面的材料准备的比较仓促，甚至错过了最佳的宣传窗口期。</p>
<p>4. 没有主动去主办方那里获悉一些信息，比如当了Science Affair开始后才知道取消presentation环节了，本来我在会议室花了半个小时准备演讲的时间就可以省掉了。</p>
<p>5. 还是跟主次不分有关，中间有段时间去调研怎么使用bing地图，最后也还是没用上，还是那句话，Hackathon开始后应该少做调研，多做E2E开发。</p>
<p>热情转换成执行力，执行力转化成信心，信心能再转化成热情。差不多是我这次做Hackathon看到不同团队成员表现后的感受。通过这几天的Hackathon，我又找到了一种做事的激情，在大公司待了一年半，这种兴奋的感觉对我来说很宝贵。</p>
<p>这次hackathon还有一个收获是我对两个老同学有了新的认识，就比如蛋妞原来做事思路比我要清晰，主次抓的很准，在微软待了两年多代码的sense和code能力也比大学时候好了很多。boliang的风格则是某一块事情做下去就能做的很干净漂亮，它定义的接口和整理的代码比我写的要清楚的多。 </p>
<p>然后于我个人而言，作了一回临时的lead，确实感受到了作为一个lead的辛苦，我很高兴的是我整个过程中虽然很辛苦，中间一连几天睡眠时间低于5个小时，一度压力山大，但是并没有让这种不好的情绪影响自己的言行，从而影响了大家，有那么几个时刻其实挺想在群里说一句抱怨的话，但最终还是克制了，不断给自己心理暗示一个好的Lead应该靠行动来感染团队，而不是靠语言靠诉苦来推动团队。虽然最后在行动上也没有做太好，不过也算是做到没有让成员觉得我就是个动嘴不动手的家伙。不过最后到了Science Fair当天还是实在是睡眠太少+压力太大而对蛋妞来了一句怒吼，好在是多年同学加室友，他并没有转身就走，要感谢蛋妞。 </p>
<p>最后附上一张某一次在公司楼道里看到的照片，不知道是哪个人写的，不能同意更多。</p>
<figure data-orig-width="735" data-orig-height="839" class="tmblr-full"><img src="/assets/img/DevelopersPainKiller.png" alt="image"></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/08/01/Hackathon-2015/" class="archive-article-date">
  	<time datetime="2015-07-31T19:59:19.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-08-01</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-恭送老司机" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/18/恭送老司机/">恭送老司机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>团队里面我的code buddy要离职了，是一个工作了8年的工程师，之前在另外一家公司做dev manager。我常常敬称他为”老司机”，因为不论技术上的讨论还是工作上的困惑他总是第一个被我咨询的人。</p>
<p>老司机教了我挺多，就在前不久，出于想秀自己知识领域的心理，在一个会上我问隔壁团队为什么不用XXX来实现。事后被老司机教育了一通：首先当你冷不丁的冒出一句&quot;why not&quot;来提出你的设计建议的时候，对方即使心理上认为是这样的，他可能也要找一些理由来解答&quot;why not&quot;，这样并没有起到帮助别人完善design的作用，你只是在享受&quot;有个东西我知道但你并不知道&quot;的心理快感而已。</p>
<p>让我最难忘的大概是他的自改诗句 &ldquo;我见青山如狗屎，青山见我亦如是&quot;，好几次被他以此句当头棒喝，此后每每想把&quot;我觉得你是SB&quot;写在脸上的时候，都不自觉的想起了这句名言而有所克制。</p>
<p>老板特地准备了一张贺卡，让团队其他成员都为他写上了祝福语，大家中午在餐厅聚了个餐，晚上几个小伙伴们去了一家bar聊天胡侃，团队的人都很喜欢和他共事，甚至隔壁team也有人一起加入了欢送他的行列。像我这种&quot;出身草莽&quot;的人是第一次见到一个人离开团队竟可以离开的这么体面与和谐，在我的认知里离职总是有些&quot;黯淡&quot;的感觉，夹杂着愤恨和不爽的负面情绪，可老司机不是，从豁然的宣布自己要离开的消息，到干干净净的把自己的工作交接完，再到和每一个人开心的道别，满满的正能量扑面而来。一方面开放的企业文化本身有起到一些作用，一方面也和老司机积极豁达的人生态度有很大关系。</p>
<p>老司机的外公在文革的时候被批斗过，他妈也就是因为被文革耽误而错过了上学的机会，外公的老年生活过的十分豁达，穿着打补丁的衣服，领着平反后的高工资，然后全部分给儿女，自己一分钱都不留，他总说他的外公对他的价值观影响深远。</p>
<p>公司没有打卡制度，但老司机基本上每天上班时间很准时，下班也是准时的5点半就走，工作依然做的很出色，每隔两周就会开着车带老婆孩子去附近的城市过周末，住当地最好的酒店。他很享受自己作为程序员这件事，因为程序员可以build things。私底下我们也会分享很多想法，但是我从来没有从他那里听到他羡慕同龄人赚的钱比自己多，或是不服气和年纪相仿的人在公司level上的差距，他认为基于比较而来的幸福并不是真正的快乐，这也是他希望她女儿能够学会的最重要的生活哲学。</p>
<p>前两天看到一句话，世上只有一种英雄主义，就是在认清生活的真相之后依然热爱生活。我觉得，老司机就是这样的一种英雄。</p>
<p>恭送老英雄。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/07/18/恭送老司机/" class="archive-article-date">
  	<time datetime="2015-07-17T17:17:52.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-07-18</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-那些年的骗子" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/11/那些年的骗子/">那些年的骗子</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在继和尚、背包客、老夫妻、中年妇女姐妹花之后，我终于又被一个半时髦大姐给骗了。 </p>
<p>今天的故事发生在火车站，离开车时间比较近，一个30出头的女性拉住了我，问我说缺点钱买票回家，按照以往的经历都是直接拒绝的，可是我见她领着一个小挎包，拿着iPhone6，染过头发，算是一个体面的人，便停了下来，加上她一直强调&quot;为了几十块钱真丢不起这个人骗你&quot;，然后我就又妇人之仁了。其实这种缺钱买票回家的骗子我遇到过，大概3,4年前，是一对中年妇女&quot;姐妹花&quot;，我也是在将信将疑的情况下解开了我的荷包，事后才意识到应该陪她们过去买票而不是把钱给他们，尽管这一次我第一反应是应该陪她一起买票，可是我当时得赶火车，所以于是我便在问了她的电话号码，并发送了他我的支付宝账号的情况下战战兢兢的送出了钱，事实上她只是跟我借73，而我由于没零钱给了她100。好吧，估计那大姐要笑死了吧。</p>
<p>晚上打她电话时，已经是&quot;您拨的用户正忙&quot;，像是被拉近了黑名单，因为用另外一个电话是能打通的，只是没人接。于是我给她发了一条短信：“你好，我是刚才火车站里借了你100块的那个人，我抱着一点侥幸心理，结果还是被你骗了，正是由于你这样的人多了，社会上冷漠的人也越来越多，不指望能拿回自己的100块钱了，祝你安好。”我想这样一条感性的短信，对于一个可能此时正在被窝里数今天收益多少的惯骗来说，可能又要笑死了吧。</p>
<p>社会在进步，骗子的技术也在提升，从装备到表演，而那些愿意对别人施予援手的人只能继续跟这样的人周旋，希望自己可以有智慧识别哪些是骗子，哪些是确实需要帮助的人，进而在每一次给予帮助的时候在内心谦卑的祈祷希望这次不是骗子，甚至变成希望对方帮帮自己告知真相。</p>
<p><strong>许多时候，不是为了什么高风亮节，更不是相信好人好报，只是害怕面对自己的冷漠。</strong>可是在面对这些复杂多变的环境，选择漠视显然来的安全的多，只是不知道是不是这样的习惯性，也使得人们在大是大非的问题面前也选择了同样的问题去看待，比如前几年的小悦悦事件。大学时候和室友一起看《离开雷锋的日子》，讲的是80年代末期中国社会集体走向犬儒，对别人的事情变得莫不关心，即使放在今天也还是有很多现实意义。</p>
<p>当然，以上这些对于“缺钱买票回家”这种case没有p指导意义，谁信谁傻。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/04/11/那些年的骗子/" class="archive-article-date">
  	<time datetime="2015-04-11T14:47:43.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-04-11</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-《自杀俱乐部》和《绣春刀》" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/29/《自杀俱乐部》和《绣春刀》/">《自杀俱乐部》和《绣春刀》</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>心血来潮的去看了这部英国当红作家尼克霍恩比的作品，讲的是圣诞夜，四个性格迥异，背景不同的失意之人在伦敦的“自杀胜地”的一座大厦楼顶不期而遇，一个声名狼藉的知名电视台主持人Martin，一个有着悲惨遭遇的家庭主妇Molly，一个失意的乐队主唱JJ，还有一个&quot;杀马特&quot;风格的问题少女Jessie，当晚发生了一些啼笑皆非的故事，然后对自杀这件事就像Martin说的，“没感觉了”，于是几个人相约组成自杀俱乐部，在情人节的晚上再次相约到大厦楼顶一起自杀，想来自杀的人原因有很多种，孤独感必然是其中一个原因，这几个孤独落魄的人凑到一起并约好一起自杀的行为，显然到后面也就只是自己骗自己了，尤其是当他们误以为Jessie跳楼了之后各自痛哭流涕，那时候他们内心早已不太有自杀的勇气和念想了。</p>
<p>四个人中最喜欢Molly的表演，把一个胆小，自卑，生活悲惨的女人的内心表达的淋漓尽致。</p>
<p>整个剧下来非常流畅，一气呵成，不拖沓，故事设计的看起来很荒唐有趣但又有一定的现实意义。很喜欢这类结构性和故事性较强的剧，比起之前看的几部都市爱情题材的剧要有意思的多，这部剧已经被强尼德普买下了电影版权准备改编成电影，可以期待一下。</p>
<p>记住了一句台词，说话结巴的JJ说的，<span>“超&hellip;屌的”。</span></p>
<p><span></span></p>
<p><span>近期开看的另外一部比较好的作品是《绣春刀》</span></p>
<p><span>这是近年来难得的武侠题材里面故事比较靠谱的电影了，很遗憾没有去电影院为他贡献票房，实在是由于之前太多的烂剧把&quot;古装武侠&quot;这个题材让观众有免疫反应了。</span></p>
<p><span>这部电影从服装道具到演员表演都是可圈可点的，知乎上有人对《绣春刀》中出现的兵器做了大量的史实性考证，<span><a href="http://www.zhihu.com/topic/20007663%E3%80%82%E6%88%91%E4%B8%AA%E4%BA%BA%E6%AF%94%E8%BE%83%E5%85%B3%E6%B3%A8%E7%94%B5%E5%BD%B1%E4%B8%AD%E7%9A%84%E4%BA%BA%E7%89%A9%E6%98%AF%E5%90%A6%E7%AB%8B%E4%BD%93%EF%BC%8C%E6%BC%94%E5%91%98%E8%A1%A8%E6%BC%94%E6%98%AF%E5%90%A6%E5%88%B0%E4%BD%8D%E3%80%82" target="_blank" rel="external">http://www.zhihu.com/topic/20007663。我个人比较关注电影中的人物是否立体，演员表演是否到位。</a></span></span></p>
<p><span><span>首先老戏骨金士杰的戏即使只是在整部电影中出现的不多，但也都是十分出彩的，只需两三句台词，就能让观众看到一个虽然落魄，但野心不死老奸巨猾的魏忠贤。</span></span></p>
<p><span><span>中年版“赵又廷”王千源又是一个“大器晚成”的典型，从“钢的琴”开始被人们所关注，他演的卢剑星是一个忠孝礼义全，五讲四美的好大哥，深知自己“棋子”的命运，却也有一些自己主见，并不是一个愚忠之人，“谁都不用死，明天我们离开京城，去过好日子”。</span></span></p>
<p><span><span>饰演丁修的演员周一围应该会是接下来几年会火起来的演员之一，非常喜欢丁修这个人物，贱贱坏坏但又有恻隐之心。</span></span></p>
<p><span>有人说刘诗诗演的周妙彤是个“绿茶婊”，若不是他最后他们三兄弟就有时间可以逃离京城，其实太不懂“导演要他们死，他们岂能不死”的道理了，这部电影注定是要带有悲剧色彩的，只不过把儿女情长和国家大事揉到一起，更能给观众带来一种纠结焦虑之感官体验，几乎史诗剧也好，武侠剧也好，悲剧主人公总要有点让人纠结的爱情故事，最后落得个“红颜祸水”的骂名，要我说这血剧中人物完全可以跳出来说，这是“导演需要啊”。当然尽管如此，刘诗诗的表演在这些好演员面前显得有点“面瘫”的，就像前段时间<a href="http://www.iqiyi.com/v_19rrnc3yic.html?src=aldzy" target="_blank" rel="external">锵锵三人行</a>里讲的，价值和价格是分开的，演技好和红不红是两码事。</span></p>
<p><span><span>最后说说张震，受过多年王家卫电影的洗礼，张震算的上是既梁朝伟之后又一位拥有“性感眼神”的演员了。绣春刀整部故事的推进就像“多米诺骨牌效应”，而推倒第一块骨牌的正是沈练在应该杀魏忠贤的时候没杀而是放走了他。最后沈练跪在三弟的尸体面前大喊“二哥做错了，二哥后悔了”，我本来以为看到这里就结束了，让身边的人死去，让做错选择的人活着承受痛苦，但导演似乎对沈练这个人物太厚爱了，后面加了一幕追杀赵靖中的戏码，可能是希望满足下大众喜欢好结局的诉求吧。<br></span></span></p>
<p>我想好的电影就该是这样的，每个人物拎出来，都有一段故事可说。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2014/09/29/《自杀俱乐部》和《绣春刀》/" class="archive-article-date">
  	<time datetime="2014-09-29T00:34:11.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-09-29</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Singleton-in-C-Sharp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/23/Singleton-in-C-Sharp/">C#中的Singleton实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一个好的Singleton应该是线程安全，支持懒加载的。以前经常写这样的Singleton:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">class Singleton</div><div class="line">&#123;</div><div class="line">    private static object lockObj = new object();</div><div class="line">    private static A instance = null;</div><div class="line">    private Singleton()</div><div class="line">    &#123;          </div><div class="line">        //init class Singleton here.</div><div class="line">    &#125;</div><div class="line">    public A Instance</div><div class="line">    &#123;</div><div class="line">          if (instance == null)</div><div class="line">          &#123;</div><div class="line">              lock(lockObj)</div><div class="line">              &#123;</div><div class="line">                   if (instance == null)</div><div class="line">                   &#123;</div><div class="line">                            instance = new Singleton();</div><div class="line">                   &#125;</div><div class="line">              &#125;</div><div class="line">          &#125;</div><div class="line">          return instance;</div><div class="line">    &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p> 一直以为这样的写法是完美的写法，其实会有以下几个问题：</p>
<ol>
<li>首先尽管它是有效的，但并不符合ECMA CLI准则，依靠<a href="http://sstompkins.wordpress.com/2011/04/12/why-memory-barrier%EF%BC%9F/" target="_blank" rel="external">memory barrier</a>的支持。</li>
<li>虽然这是c# Code，但可能有些人也会把他应用到Java中，在Java中，对象指针赋值可能已经在构造函数执行完成之前就进行了，这就会有问题</li>
</ol>
<p>事实上这个版本是强烈不被推荐的写法。</p>
<p>第二版：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Singleton</div><div class="line">&#123;</div><div class="line">    private static readonly Singleton instance = new Singleton();</div><div class="line">    private static Singleton()</div><div class="line">     &#123;</div><div class="line">     &#125;</div><div class="line">     private Singleton()</div><div class="line">     &#123;</div><div class="line">     &#125;</div><div class="line">     public static Singleton Instance</div><div class="line">     &#123;</div><div class="line">         get</div><div class="line">         &#123;</div><div class="line">                 return instance;</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里增加一个静态的构造方法，主要是告诉CLR，这个类型是<a href="http://csharpindepth.com/Articles/General/Beforefieldinit.aspx" target="_blank" rel="external">beforefieldinit</a>的，这个构造方法在同一个应用域下只会被执行一次，这就保证了线程安全，并且被触发的时机是：</p>
<ol>
<li>这个类的实例被创建。</li>
<li>任何静态成员被引用了。</li>
</ol>
<p>由于这个性质，所以某些情况下，并不是完全懒加载的，比如在还没有调用这个Singleton方法之前引用了他别的静态成员，那么这个Singleton会由于被引用了静态成员而被创建。</p>
<p>基于上面这个问题，我们就有了接下来的版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Singleton</div><div class="line">&#123;</div><div class="line">     Singleton()</div><div class="line">     &#123;</div><div class="line">     &#125;</div><div class="line">     public static Singleton Instance</div><div class="line">     &#123;</div><div class="line">            return Nested.instance;</div><div class="line">     &#125;</div><div class="line">    private class Nested</div><div class="line">    &#123;</div><div class="line">         internal static readonly Singleton instance = new Singleton();</div><div class="line">         private static Nested()</div><div class="line">         &#123;</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过这样，就保证了即使Singleton的静态成员被访问，也不会trigger它的构造函数，做到真正的lazy load.</p>
<p>Reference: <a href="http://www.yoda.arachsys.com/csharp/singleton.html" target="_blank" rel="external">http://www.yoda.arachsys.com/csharp/singleton.html</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2014/07/23/Singleton-in-C-Sharp/" class="archive-article-date">
  	<time datetime="2014-07-22T17:51:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-07-23</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-值类型-引用类型-in-C" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/24/值类型-引用类型-in-C/">值类型/引用类型 in C#</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在c#中，有两种类型，一种是ValueType，像int,double,以及struct; 一种是Reference Type, 如string,自定义类. </p>
<p>像Struct这样的结构，它是被认为是ValueType的，也就是函数调用的时候，会拷贝出一个新的Struct传给函数，如果Struct中有自定义类型，则会拷贝该类型的引用。</p>
<p>例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">public class A</div><div class="line">&#123;</div><div class="line">    public int value;</div><div class="line">&#125;;</div><div class="line">public struct B</div><div class="line">&#123;</div><div class="line">    public int value;</div><div class="line">&#125;</div><div class="line">public static void SetValue(A p1, B p2)</div><div class="line">&#123;</div><div class="line">    p1.value = 1;</div><div class="line">    p2.value = 1;</div><div class="line">&#125;</div><div class="line">public static void Main()</div><div class="line">&#123;</div><div class="line">    A a = new A() &#123; value=0 &#125;;</div><div class="line">    B b = new B() &#123; value=0 &#125;;</div><div class="line">    Console.WriteLine(&quot;before:A:&#123;0&#125;,B:&#123;1&#125;&quot;, a.value, b.value);</div><div class="line">    SetValue(a, b);</div><div class="line">    Console.WriteLine(&quot;after:A:&#123;0&#125;,B:&#123;1&#125;&quot;, a.value, b.value);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>  上面代码运行的结果是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">before:A:0,B:0 </div><div class="line">after:A:1,B:0</div></pre></td></tr></table></figure></p>
<p>   可以看到class作为参数传入函数中是只是作为一个引用地址，而struct则是复制了一份数据。</p>
<p><a href="http://www.yoda.arachsys.com/java/passing.html" target="_blank" rel="external">Jon&rsquo;s Homepage</a> 给出了更好的解释，尽管是说java的</p>
<p><strong>Truth 1: Everything in Java is passed by value. Objects, however, are never passed <em>at all</em>.</strong><br><strong>Truth 2: The values of variables are always primitives or references, never objects.</strong></p>
<p>内存分配</p>
<p>CLR把内存分配在两个结构中：堆和栈，当一个函数被调用的时候，CLR会将将调用方法相关的方法地址，参数push到栈中。当方法被执行完成时，栈顶元素会被pop出来，并且函数的传入参数，以及内部参数声明会被释放掉。</p>
<p>而堆分配的内存可以被随时且任意的访问，堆需要依赖内存管理和垃圾回收。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public void Test()</div><div class="line">&#123;</div><div class="line">    A a = new A();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里a是一个指向A的指针，这个指针占用的空间在栈中，而它指向的地址是在堆中。</p>
<p>栈主要存以下两样东西</p>
<p><strong>本地声明的对象指针，如a.</strong><br><strong>本地声明的值类型和函数参数.</strong></p>
<p>堆则主要存</p>
<p><strong>一个引用类型的内容，如果引用类型的内容还有引用的类型的话，那个引用指向的内容也是存在堆上的。</strong></p>
<p>关键字 ref 和 out的区别</p>
<p>而ref和out的区别就是使用了ref的指针必须是已经完成了值内存分配的，而out则没有这个要求。</p>
<p>reference:</p>
<p><a href="http://www.albahari.com/valuevsreftypes.aspx" target="_blank" rel="external">http://www.albahari.com/valuevsreftypes.aspx</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2014/06/24/值类型-引用类型-in-C/" class="archive-article-date">
  	<time datetime="2014-06-23T20:29:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2014-06-24</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 xtt129
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				
    			</div>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>